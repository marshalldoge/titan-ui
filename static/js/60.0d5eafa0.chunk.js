(this["webpackJsonptitan-ui"]=this["webpackJsonptitan-ui"]||[]).push([[60],{770:function(e,t,a){"use strict";a.r(t);var n=a(58),l=a(59),s=a(87),r=a(62),i=a(61),o=a(0),u=a.n(o),c=a(10),d=a(236),m=a(448),p=a(509),h=a(510),y=a(755),I=a(336),f=(a(73),a(162),a(23),a(22)),C=a(329),v=a(21),b=a(79),g=(a(771),a(25)),S=a.n(g),Q=(m.a.Title,u.a.lazy((function(){return Promise.all([a.e(0),a.e(54)]).then(a.bind(null,155))}))),E=function(e){Object(r.a)(a,e);var t=Object(i.a)(a);function a(e){var l;return Object(n.a)(this,a),(l=t.call(this,e)).state={saleItemQuantities:{0:{hashcode:"",name:"",salePrice:"",quantity:"",total:""}},lastItemId:0,total:0},l.saveSale=function(){var e=Object(s.a)(l),t=[],a=l.state.saleItemQuantities;for(var n in a)if(a.hasOwnProperty(n)){var r=a[n];parseInt(n)!==parseInt(l.state.lastItemId)&&t.push(r)}var i=S()().format("YYYY-MM-DD[T]HH:mm:ss"),o=JSON.stringify({idAppUser:l.props.idAppUser,idClient:l.props.client.id,billName:l.props.billName,nit:l.props.nit,idShift:l.props.idShift,idCurrency:"1",idCompany:l.props.idCompany,idWarehouse:l.props.idWarehouse,time:i,total:l.state.total,itemQuantities:t,paid:l.state.total}),u={"Content-Type":"application/json; charset=utf-8",Authorization:Object(v.b)("JWT")},c=Object(v.k)(b.a+"/Sale",{});fetch(c,{method:"POST",headers:u,body:o}).then((function(e){return e.json()})).then((function(t){t.success?(console.log("Sale saved successfully"),e.props.increaseClientSaleCount(e.props.client.id),e.props.increaseSaleCount()):console.log("Failed with error ",t.statusMessage)}))},l.styleHeaderRow={borderWidth:"4px",borderRadius:"10px",height:"50px",background:"white"},l.styleRow={borderWidth:"4px",borderRadius:"10px",height:"50px",background:"white"},l.styleCell={height:"100%",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},l.styleInputName={width:"90%"},l.styleInputNumber={width:"80%"},l.onSelect=function(e,t,a){var n=l.state.saleItemQuantities;console.log("IdSaleItem rendered: ",a),n[a].hashcode=e,l.setState({saleItemQuantities:n},(function(){return l.fillRowData(e,a)}))},l.handleCodeChange=function(e,t){var a=l.state.saleItemQuantities;console.log("IdSaleItem rendered: ",t),a[t].hashcode=e,t===l.state.lastItemId&&(a[t+1]={hashcode:"",name:"",salePrice:"",quantity:"",total:""}),l.setState({saleItemQuantities:a},(function(){l.fillRowData(e,t)}))},l.handleSPChange=function(e,t){var a=e.target.value,n=l.state.saleItemQuantities;n[t].salePrice=a,""===a&&(a=0);var s=""===n[t].quantity?0:n[t].quantity,r=parseFloat(n[t].total);n[t].total=parseFloat(a)*parseFloat(s);var i=l.state.total;l.setState({total:i-r+n[t].total}),l.setState({saleItemQuantities:n})},l.handleQuantityChange=function(e,t){var a=e.target.value,n=l.state.saleItemQuantities;n[t].quantity=a,""===a&&(a=0);var s=""===n[t].salePrice?0:n[t].salePrice,r=parseFloat(n[t].total);console.log(a," * ",s),n[t].total=parseFloat(a)*parseFloat(s);var i=l.state.total;l.setState({total:i-r+n[t].total}),l.setState({saleItemQuantities:n})},l.fillRowData=function(e,t){var a=l.props.itemQuantityHashMap[l.props.idWarehouse][e];if(void 0!==a){var n=l.state.saleItemQuantities;n[t]={hashcode:e,name:a.name,salePrice:a.salePrice,quantity:1,total:a.salePrice,idMeasure:a.idMeasure,idCurrency:a.idCurrency,idItem:a.idItem};var s=l.state.total;l.setState({total:s+n[t].total}),l.setState({saleItemQuantities:n}),t===l.state.lastItemId&&l.setState({lastItemId:t+1})}else{console.log("Code not found");var r=l.state.saleItemQuantities;r[t]={hashcode:e,name:"",salePrice:"",quantity:0,total:0},l.setState({saleItemQuantities:r})}},l.removeItem=function(e){var t=l.state.saleItemQuantities;delete t[e],l.setState({saleItemQuantities:t})},l.removeItemButton=function(e){return e!==l.state.lastItemId?u.a.createElement(Q,{type:"danger",label:u.a.createElement(d.a,null),onClick:function(){return l.removeItem(e)}}):null},l.headers=function(){return u.a.createElement(p.a,{type:"flex",className:"headerCtn",style:l.styleHeaderRow},u.a.createElement(h.a,{span:4,order:1},"C\xf3digo"),u.a.createElement(h.a,{span:5,order:2},"Name"),u.a.createElement(h.a,{span:4,order:3},"Cantidad"),u.a.createElement(h.a,{span:4,order:4},"PV"),u.a.createElement(h.a,{span:4,order:5},"Total"),u.a.createElement(h.a,{span:3,order:5},"Remover"))},l.SaleItemQuantity=function(){var e=Object(s.a)(l),t=l.state.saleItemQuantities,a=[];for(var n in t)t.hasOwnProperty(n)&&a.push(e.ItemQuantity(t[n],parseInt(n)));return u.a.createElement("div",{style:{}},a,u.a.createElement("br",null),u.a.createElement(p.a,null,u.a.createElement(h.a,{span:10,style:{textAlign:"start"}},u.a.createElement(Q,{label:"Total: "+l.state.total,size:"big"})),u.a.createElement(h.a,{span:8,offset:6,style:{textAlign:"end"}},u.a.createElement(Q,{type:"inverse",onClick:l.saveSale,label:"GUARDAR",size:"big"}))))},l.ItemQuantity=function(e,t){return u.a.createElement(p.a,{type:"flex",style:l.styleRow,key:t},u.a.createElement(h.a,{span:4,order:1,style:l.styleCell},u.a.createElement(y.a,{style:l.styleInputName,dataSource:l.props.itemQuantityCode[l.props.idWarehouse],onSelect:function(e,a){return l.onSelect(e,a,t)},placeholder:"Codigo...",filterOption:!0,onChange:function(e){return l.handleCodeChange(e,t)},value:e.hashcode})),u.a.createElement(h.a,{span:5,order:2,style:l.styleCell},u.a.createElement(I.a,{style:l.styleInputName,value:e.name})),u.a.createElement(h.a,{span:4,order:3,style:l.styleCell},u.a.createElement(I.a,{style:l.styleInputNumber,value:e.quantity,onChange:function(e){return l.handleQuantityChange(e,t)}})),u.a.createElement(h.a,{span:4,order:4,style:l.styleCell},u.a.createElement(I.a,{style:l.styleInputNumber,value:e.salePrice,onChange:function(e){return l.handleSPChange(e,t)}})),u.a.createElement(h.a,{span:4,order:5,style:l.styleCell},u.a.createElement(I.a,{style:l.styleInputNumber,value:e.total})),u.a.createElement(h.a,{span:3,order:5,style:l.styleCell},l.removeItemButton(t)))},l.removeItem.bind(Object(s.a)(l)),l}return Object(l.a)(a,[{key:"render",value:function(){return u.a.createElement("div",null,this.headers(),this.SaleItemQuantity())}}]),a}(o.Component);t.default=Object(c.g)(Object(f.b)((function(e){var t=e.appUserReducer,a=e.itemQuantityReducer,n=t.idAppUser,l=t.idWarehouse,s=t.idShift,r=t.idCompany,i=a.itemQuantityCode,o=a.itemQuantityHashMap;return console.log("Codes to be displayed for autocomplete: ",i[l]),{idAppUser:n,itemQuantityCode:i,idWarehouse:l,itemQuantityHashMap:o,idShift:s,idCompany:r}}),{increaseSaleCount:C.c,increaseClientSaleCount:C.b})(E))},771:function(e,t,a){}}]);
//# sourceMappingURL=60.0d5eafa0.chunk.js.map