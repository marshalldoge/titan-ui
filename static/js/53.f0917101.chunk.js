(this["webpackJsonptitan-ui"]=this["webpackJsonptitan-ui"]||[]).push([[53],{426:function(e,t,n){},752:function(e,t,n){},856:function(e,t,n){"use strict";n.r(t);var a=n(58),i=n(59),o=n(87),s=n(62),r=n(61),c=n(0),p=n.n(c),l=n(10),h=n(509),d=n(510),f=(n(73),n(162),n(23),n(426),n(22)),u=n(25),S=n.n(u),m=n(21),y=n(79),b=(n(752),n(329)),g=(n(29),p.a.lazy((function(){return Promise.all([n.e(0),n.e(8)]).then(n.bind(null,155))}))),C=p.a.lazy((function(){return Promise.all([n.e(1),n.e(2),n.e(3),n.e(4),n.e(7)]).then(n.bind(null,158))})),j=function(e){Object(s.a)(n,e);var t=Object(r.a)(n);function n(){var e;Object(a.a)(this,n);for(var i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))).state={cashOpen:0,inShift:e.props.inShift,columnDefs:[{headerName:"ID",field:"id",width:"10%"},{headerName:"Hora",field:"time",width:"15%"},{headerName:"Cliente",field:"billName",width:"30%"},{headerName:"Pagado",field:"paid",width:"15%"},{headerName:"Total",field:"total",width:"15%"},{headerName:"Moneda",field:"currency",width:"15%"}],windowHeight:document.body.clientHeight,now:S()()},e.createShift=function(){var t={"Content-Type":"application/json; charset=utf-8",Authorization:Object(m.b)("JWT")},n={idAppUser:e.props.idAppUser,action:"create",time:e.state.now},a=e.state.now.clone(),i=a.format("YYYY-MM-DD[T]HH:mm:ss"),s=JSON.stringify({idAppUser:e.props.idAppUser,cashOpen:e.state.cashOpen,cashClosed:e.state.cashOpen,open:i,idCompany:e.props.idCompany,saleCount:e.props.saleCount}),r=Object(o.a)(e),c=Object(m.k)(y.a+"/Shift",n);fetch(c,{method:"POST",headers:t,body:s}).then((function(e){return e.json()})).then((function(e){console.log("Shift created and retrieved forn database: ",e),r.setState({open:a},(function(){r.props.setIdShift(e),e.open=a,r.props.openShift(e),r.setState({inShift:!0})}))}))},e.closeShift=function(){var t={"Content-Type":"application/json; charset=utf-8",Authorization:Object(m.b)("JWT")},n={idAppUser:e.props.idAppUser,action:"update"},a=e.state.now.clone().format("YYYY-MM-DD[T]HH:mm:ss"),i=e.state.now,s=e.props.open,r=i.diff(s),c=S.a.duration(r).asSeconds(),p=JSON.stringify({id:e.props.idShift,idAppUser:e.props.idAppUser,cashClose:e.state.cashClose,close:a,duration:c}),l=Object(o.a)(e),h=Object(m.k)(y.a+"/Shift",n);fetch(h,{method:"POST",headers:t,body:p}).then((function(e){return e.json()})).then((function(e){e.id=null,l.props.setShift(e),l.props.setIdShift(e),l.props.closeShift(),l.setState({inShift:!1})}))},e.goToMakeSaleForm=function(){e.props.history.push("/MakeSaleForm")},e.MakeSaleButton=function(){return p.a.createElement(g,{label:"Realizar Venta",size:"expanded",onClick:e.goToMakeSaleForm})},e.OpenShiftButton=function(){return p.a.createElement(g,{label:"Abrir Caja",size:"expanded",onClick:e.createShift})},e.CloseShiftButton=function(){return p.a.createElement(g,{label:"Cerrar Caja",size:"medium",onClick:e.closeShift,type:"inverse"})},e.onRowClick=function(t){e.props.history.push({pathname:"SaleProfile",search:"?idSale="+t.id})},e.SaleTable=function(){return p.a.createElement(C,{clientHashMap:e.props.clientHashMap,currencyHashMap:e.props.currencyHashMap,idAppUser:e.props.idAppUser,idShift:e.props.idShift,columnDefs:e.state.columnDefs,loadTablePage:e.loadSaleTablePageByIdShift,length:12,onRowClick:e.onRowClick,title:"Ventas",pageSize:11})},e}return Object(i.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(e,t,n){}},{key:"componentWillUnmount",value:function(){}},{key:"loadSaleTablePageByIdShift",value:function(e){var t={"Content-Type":"application/json; charset=utf-8",Authorization:Object(m.b)("JWT")},n=this,a={idAppUser:this.props.idAppUser,idShift:this.props.idShift,page:e,pageSize:this.props.pageSize},i=Object(m.k)(y.a+"/Sale/findSaleByIdAppUserAndIdShiftPaginated",a);fetch(i,{method:"GET",headers:t}).then((function(e){return e.json()})).then((function(t){t.success&&n.setState((function(a){for(var i=0;i<t.data.content.length;i++)t.data.content[i].time=S()(t.data.content[i].time,"YYYY-MM-DD[T]HH:mm:ss").format("HH:mm:ss"),t.data.content[i].billName=n.props.clientHashMap[t.data.content[i].idCurrency].billName,t.data.content[i].currency=n.props.currencyHashMap[t.data.content[i].idCurrency].abbreviation,console.log("new: ",t.data.content[i].currency);return a.pageData[e]=t.data.content,console.log("New state:",a),a}))})).catch((function(e){console.log(e)}))}},{key:"render",value:function(){return console.log("inShift? ",this.state.inShift),p.a.createElement("div",null,p.a.createElement(h.a,{style:{height:"60px",paddingTop:"10px"},type:"flex",justify:"center"},p.a.createElement(d.a,{span:24},this.state.inShift?this.MakeSaleButton():this.OpenShiftButton())),p.a.createElement(h.a,{type:"flex",justify:"center"},p.a.createElement(d.a,{span:24},this.state.inShift&&this.SaleTable())),p.a.createElement(h.a,{type:"flex",justify:"end"},p.a.createElement(d.a,{span:6,style:{textAlign:"end"}},this.state.inShift&&this.CloseShiftButton())))}}]),n}(c.Component);t.default=Object(l.g)(Object(f.b)((function(e){var t=e.appUserReducer,n=e.shiftReducer,a=e.currencyReducer,i=e.clientReducer,o=t.idAppUser,s=t.idShift,r=t.inShift,c=t.saleCount,p=n.open,l=a.currencyHashMap,h=i.clientHashMap;return console.log("idShift Received: ",s),{idAppUser:o,idShift:s,open:p,inShift:r,saleCount:c,currencyHashMap:l,clientHashMap:h}}),{openShift:b.d,setIdShift:b.l,closeShift:b.a,setShift:b.t})(j))}}]);
//# sourceMappingURL=53.f0917101.chunk.js.map